<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
</head>
<body>
    <a href = "/login">Login</a>
    <a href = "/register">Register</a>
    <a href = "/newproduct">Add Product</a>
    <a href = "/home">Home</a>
    <a href = "/dashboard">Dashboard</a>
    <a href = "/logout">Logout</a>
    <form action="/sort" method="POST" >
        <div >
            <label for="sort"> Sort By </label>
            <select  id="category" name="sort">
            
                <option value="alpha"> Alphabetical Order </option>
                <option value="baseprice"> Base Price </option>
                <option value="bid"> Highest Bid </option>
                
            </select>
        </div>
        <button>Apply</button>
    </form>
    <form  action="/search" method="POST">
        <!-- <div >
            <label for="tag"> Product Category </label>
            <select  id="productcategory" name="tag">
               
                <option value="Statues"> Statues </option>
                <option value="Coins"> Coins </option>
                <option value="Paintings"> Paintings </option>
                <option value="Ornaments"> Ornaments </option>
                <option value="Tools"> Tools </option>
                <option value="Other Products"> Other products </option>
            </select>
        </div> -->
        <!-- <div>
            <label for="search"></label> -->
            <input id="search" name="search"  type="search"  type="search" placeholder="Search products"  aria-label="Search" 
                size="15" value="<%= typeof search != 'undefined' ? search : '' %>" />
        <!-- </div>     -->
        <button type="submit"> Search </button>
    </form>
    
    <% if(flg == "0") {%> 
      
        <% if(products1 !== []){ %> 
    <% for(let product of products1 ) { %>
        <% var deadlineDate = new Date(product.end) %> 
        <% var startDate = new Date(product.start) %> 
        <% var now = Date.now() %> 
        
        <h1>Name : <%= product.productname %> </h1>
        <h3>Description : <%= product.description %> </h3>
        <h3>Tag : <%= product.tag %> </h3>
        <h3>Base Price :<%= product.baseprice %></h3>
        <h3>Owner : <%= product.owner.username %> </h3>
        <h3>Auction Start Time : <%= product.start %> </h3>
        <h3>Auction End Time : <%= product.end %> </h3>
        <% if(product.price.length !== 0) {%> 
          <h3>Highest Bid : <%= product.price[product.price.length -1] %> &nbsp &nbsp &nbsp Bidder :<%= product.biders[product.biders.length -1].username %> </h3>
        <% } %> 
        <img src="data:image/<%= product.image.contentType %>;base64, 
		<%= product.image.data.toString('base64') %>" width="300" height="300" alt="Image"> 
        <a href = "/productdetails/<%= product._id %>">Details</a>
       
        <% if(deadlineDate >= now && startDate <= now) {%> 
            <a href = "/bid/<%= product._id %>">Bid Here</a>
        <% } %> 
    <% } %>  
    <% }else { %>  
        <h1>Sorry No Products </h1>
    <% } %> 
    <% } %>  
    <% if(products !== []){ %> 
        
        <% for(let product of products) { %>
        <% var deadlineDate = new Date(product.end) %> 
        <% var startDate = new Date(product.start) %> 
        <% var now = Date.now() %> 
        
        <h1>Name : <%= product.productname %> </h1>
        <h3>Description : <%= product.description %> </h3>
        <h3>Tag : <%= product.tag %> </h3>
        <h3>Base Price :<%= product.baseprice %></h3>
        <h3>Owner : <%= product.owner.username %> </h3>
        <h3>Auction Start Time : <%= product.start %> </h3>
        <h3>Auction End Time : <%= product.end %> </h3>
        <% if(product.price.length !== 0) {%> 
          <h3>Highest Bid : <%= product.price[product.price.length -1] %> &nbsp &nbsp &nbsp Bidder :<%= product.biders[product.biders.length -1].username %> </h3>
        <% } %> 
        <img src="data:image/<%= product.image.contentType %>;base64, 
		<%= product.image.data.toString('base64') %>" width="300" height="300" alt="Image"> 
        <a href = "/productdetails/<%= product._id %>">Details</a>
       
        <% if(deadlineDate >= now && startDate <= now) {%> 
            <a href = "/bid/<%= product._id %>">Bid Here</a>
        <% } %> 
        <% } %>  
        <% }else { %>  
            <h1>Sorry No Products </h1>
        <% } %>  
</body>
</html>